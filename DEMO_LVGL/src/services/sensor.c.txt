#include "sensor.h"
#include <freertos/semphr.h>

#define SENSOR_RETRY_DELAY_MS 500

volatile int s_contador_datos = 0;
extern QueueHandle_t sensor_cmd_queue;
SemaphoreHandle_t lvgl_mutex;

void _sensor_process_data(void* parameter);

void sensor_init(void) {

    lvgl_mutex = xSemaphoreCreateMutex();
    
    xTaskCreate(
        _sensor_process_data,
        "SensorTask",
        4096,
        NULL,
        1,
        NULL
    );
}

void _sensor_process_data(void* parameter) {
    int cmd_recibido;

    for (;;) {

        if (xQueueReceive(sensor_cmd_queue, &cmd_recibido, 0) == pdPASS) {
            if (cmd_recibido == 1) {
                s_contador_datos = 0; // REINICIO
            }
        }

        s_contador_datos++;

        vTaskDelay(pdMS_TO_TICKS(1000)); // Esperar 1 seg
    }

}